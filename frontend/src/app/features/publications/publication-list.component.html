<div class="publication-list-container">
  <p-toast></p-toast>

  <div class="list-wrapper">
    <!-- Header Section -->
    <div class="header-section">
      <p-card styleClass="header-card">
        <div class="header-content">
          <div class="title-section">
            <h1 class="page-title">
              <i class="pi pi-book"></i>
              Publications Library
            </h1>
            <p class="page-subtitle">
              Browse books and magazines published by our authors.
            </p>
          </div>

          <div class="header-actions">
            <button
              pButton
              type="button"
              icon="pi pi-refresh"
              class="p-button-outlined refresh-btn"
              (click)="loadPublications()"
              [loading]="isLoading"
              pTooltip="Refresh publications list"
              tooltipPosition="bottom"
            ></button>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Table Section -->
    <div class="table-section">
      <p-card styleClass="table-card">
        <!-- Loading State -->
        <div class="loading-container" *ngIf="isLoading">
          <p-progressSpinner [style]="{ width: '50px', height: '50px' }" strokeWidth="4"></p-progressSpinner>
          <p class="loading-text">Loading publications...</p>
        </div>

        <!-- Error State -->
        <div class="error-container" *ngIf="hasError && !isLoading">
          <i class="pi pi-exclamation-triangle error-icon"></i>
          <h3>Failed to Load Publications</h3>
          <p>We couldn't retrieve the list. Please try again.</p>
          <button
            pButton
            type="button"
            label="Retry"
            icon="pi pi-refresh"
            class="p-button-outlined"
            (click)="loadPublications()"
          ></button>
        </div>

        <!-- Success Content -->
        <div *ngIf="!isLoading && !hasError" class="table-container">
          <div *ngIf="groupedPublications$ | async as publications">
            <div class="table-header">
              <h3 class="table-title">
                <i class="pi pi-list"></i>
                Books ({{ publications.books.length }})
              </h3>
            </div>

            <p-table [value]="publications.books" [responsiveLayout]="'scroll'">
              <ng-template pTemplate="header">
                <tr>
                  <th>Title</th>
                  <th>ISBN</th>
                  <th>Author</th>
                  <th>Publication Date</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-book>
                <tr>
                  <td>{{ book.title }}</td>
                  <td>{{ book.isbn }}</td>
                  <td>{{ book.author.name }}</td>
                  <td>{{ book.publicationDate | date: 'mediumDate' }}</td>
                </tr>
              </ng-template>
            </p-table>

            <div class="table-header">
              <h3 class="table-title">
                <i class="pi pi-list"></i>
                Magazines ({{ publications.magazines.length }})
              </h3>
            </div>

            <p-table [value]="publications.magazines" [responsiveLayout]="'scroll'">
              <ng-template pTemplate="header">
                <tr>
                  <th>Title</th>
                  <th>Issue Number</th>
                  <th>Published Date</th>
                  <th>Authors</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-magazine>
                <tr>
                  <td>{{ magazine.title }}</td>
                  <td>{{ magazine.issueNumber }}</td>
                  <td>{{ magazine.publishedDate | date: 'mediumDate' }}</td>
                  <td>
                    <div class="authors-tags">
                      <p-tag
                        *ngFor="let author of magazine.authors"
                        [value]="author.name"
                        severity="info"
                        class="author-tag"
                      ></p-tag>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </p-card>
    </div>
  </div>
</div>
